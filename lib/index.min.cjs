#!/usr/bin/env node
var j=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var R=j((B,x)=>{x.exports={en:{intro:"\u{1F680} NPM Script Runner",selectProject:"\u{1F4C1} Select project location",projectPathRequired:"Project path is required!",noPackageJson:"No package.json found in the selected path!",noScripts:"No available scripts found.",selectScript:"\u{1F527} Select a script to run:",runLastScript:"Do you want to run the last script",running:"\u{1F4E6} Running script:",success:"\u2705 Script executed successfully!",failure:"\u274C Script execution failed, exit code:",interrupted:"\u{1F6D1} Script interrupted by user",thanks:"Thank you for using NPM Script Runner",operationCancelled:"Operation cancelled",helpTitle:"\u{1F680} NPM Script Runner (nrs) Help",availableCommands:"Available commands:",showHelp:"Show this help information",listScripts:"List and select scripts to run",advancedMode:"Enter advanced mode: select project path and run scripts",searchScripts:"Search for scripts and run matching ones",runRecentScript:"Run the most recently used script",runRecentScriptN:"Run the nth most recently used script",listRecentScripts:"View the list of recently used scripts",listAllScripts:"Display all available scripts",examples:"Examples:",searchScriptsTest:"Search for scripts containing 'test' and run",runRecentScript2:"Run the 2nd most recently used script",changeLanguage:"Change the display language (available: en, zh)",languageChanged:"Language changed to English",unsupportedLanguage:"Unsupported language. Please use 'en' for English or 'zh' for Chinese.",recentCommands:"Recently used scripts in",noRecentScript:"No recent script found at index",availableScripts:"Available scripts:",version:"NPM Script Runner version:"},zh:{intro:"\u{1F680} NPM \u811A\u672C\u8FD0\u884C\u5668",selectProject:"\u{1F4C1} \u9009\u62E9\u9879\u76EE\u4F4D\u7F6E",projectPathRequired:"\u9879\u76EE\u8DEF\u5F84\u5FC5\u586B\uFF01",noPackageJson:"\u6240\u9009\u8DEF\u5F84\u4E0B\u6CA1\u6709\u627E\u5230 package.json \u6587\u4EF6\uFF01",noScripts:"\u6CA1\u6709\u627E\u5230\u53EF\u7528\u7684\u811A\u672C\u3002",selectScript:"\u{1F527} \u9009\u62E9\u8981\u8FD0\u884C\u7684\u811A\u672C:",runLastScript:"\u662F\u5426\u8FD0\u884C\u4E0A\u6B21\u7684\u811A\u672C",running:"\u{1F4E6} \u6B63\u5728\u8FD0\u884C\u811A\u672C:",success:"\u2705 \u811A\u672C\u6267\u884C\u6210\u529F\uFF01",failure:"\u274C \u811A\u672C\u6267\u884C\u5931\u8D25\uFF0C\u9000\u51FA\u7801:",interrupted:"\u{1F6D1} \u811A\u672C\u88AB\u7528\u6237\u4E2D\u65AD",thanks:"\u611F\u8C22\u4F7F\u7528 NPM \u811A\u672C\u8FD0\u884C\u5668",operationCancelled:"\u64CD\u4F5C\u5DF2\u53D6\u6D88",version:"NPM \u811A\u672C\u8FD0\u884C\u5668\u7248\u672C\uFF1A",changeLanguage:"\u66F4\u6539\u663E\u793A\u8BED\u8A00\uFF08\u53EF\u7528\uFF1Aen, zh\uFF09",languageChanged:"\u8BED\u8A00\u5DF2\u66F4\u6539\u4E3A\u4E2D\u6587"}}});var d=j((K,I)=>{I.exports={name:"scriptz-cli",version:"0.0.3",description:"A CLI tool to visualize and run npm scripts",main:"lib/index.cjs",module:"lib/index.mjs",exports:{".":{require:"./lib/index.cjs",import:"./lib/index.mjs"}},bin:{nrs:"lib/index.cjs"},scripts:{start:"node run-script.js",build:"node build.js",prepublishOnly:"npm run build"},files:["lib","README.md","README.zh-cn.md","demo.png","LICENSE"],dependencies:{"@clack/prompts":"^0.7.0",commander:"^12.1.0",picocolors:"^1.1.0"},devDependencies:{esbuild:"^0.19.0"},keywords:["npm","scripts","cli","tool"],author:"zzcyes",license:"MIT",repository:{type:"git",url:"https://github.com/zzcyes/scriptz-cli.git"},bugs:{url:"https://github.com/zzcyes/scriptz-cli/issues"},homepage:"https://github.com/zzcyes/scriptz-cli#readme"}});var{Command:A}=require("commander"),{intro:J,outro:l,select:k,confirm:T,isCancel:h,text:H}=require("@clack/prompts"),{readFileSync:y,writeFileSync:D,existsSync:z}=require("fs"),{spawn:F}=require("child_process"),n=require("picocolors"),$=require("path"),V=R(),N="en",e=s=>V[N][s]||s,p=new A,S=$.join(__dirname,".script-history.json"),v=()=>z(S)?JSON.parse(y(S,"utf8")):{},L=(s,t)=>{var c;let r=v();r[s]=[t,...((c=r[s])==null?void 0:c.filter(o=>o!==t))||[]].slice(0,10),D(S,JSON.stringify(r,null,2))},w=s=>v()[s]||[],G=(s,t)=>w(s)[t]||null,W=s=>{let t=w(s);console.log(n.cyan(`
${e("recentCommands")}: ${s}`)),t.forEach((r,c)=>{console.log(`  ${n.yellow(c+1)}: ${n.green(r)}`)})},M=async s=>{if(!s)return process.cwd();let t=await H({message:e("selectProject"),initialValue:process.cwd(),validate:r=>{if(!r||r.length===0)return e("projectPathRequired");if(!z($.join(r,"package.json")))return e("noPackageJson")}});return h(t)&&(l(n.yellow(e("operationCancelled"))),process.exit(0)),t},q=s=>{let t=JSON.parse(y($.join(s,"package.json"),"utf8")).scripts||{};return Object.keys(t).length===0&&(l(n.yellow(e("noScripts"))),process.exit(0)),t},_=s=>Object.entries(s).map(([t,r])=>({value:t,label:`${n.green(t)} ${n.dim(`- ${r}`)}`})),P=async(s,t,r)=>{if(r){let c=s.filter(a=>a.value.toLowerCase().includes(r.toLowerCase()));c.length===0&&(console.log(n.yellow(e("noMatchingScripts"))),process.exit(0));let o=await k({message:e("selectMatchingScript"),options:c});return h(o)&&(l(n.yellow(e("operationCancelled"))),process.exit(0)),o}if(t){let c=await k({message:e("selectScript"),options:s});return h(c)&&(l(n.yellow(e("operationCancelled"))),process.exit(0)),c}},E=(s,t)=>{t||(l(n.yellow(e("noScriptSelected"))),process.exit(0)),console.log(`
${e("running")} ${n.cyan(t)}`);let r=F("npm",["run",t],{stdio:"inherit",shell:!0,cwd:s});r.on("exit",c=>{console.log(c===0?`
${e("success")}`:`
${e("failure")} ${c}`),l(n.bgCyan(` ${e("thanks")} `))}),process.on("SIGINT",()=>{r.kill("SIGINT"),console.log(`
${e("interrupted")}`),l(n.bgCyan(` ${e("thanks")} `)),process.exit(0)})},m=async(s={})=>{let{searchTerm:t,advanced:r,listOnly:c,recentIndex:o}=s;J(`${n.bold(n.cyan(e("intro")))} ${n.dim(d().version)}`);let a=await M(r),g=q(a),b=_(g),i;if(o!==void 0)i=G(a,o),i||(l(n.yellow(`${e("noRecentScript")} ${o+1}.`)),process.exit(0));else if(t)i=await P(b,!1,t);else if(!c){let u=w(a);if(u.length>0&&g[u[0]]){let C=await T({message:`${e("runLastScript")} "${n.cyan(u[0])}"?`});h(C)&&(l(n.yellow(e("operationCancelled"))),process.exit(0)),C&&(i=u[0])}}return i||(i=await P(b,c)),i?(L(a,i),E(a,i)):(l(n.bgCyan(` ${e("thanks")} `)),process.exit(0)),i},f=()=>{console.log(n.cyan(`
${e("helpTitle")}`)),console.log(n.dim(`
${e("availableCommands")}`)),console.log(`  ${n.green("nrs")}               ${e("listScripts")}`),console.log(`  ${n.green("nrs -l")}            ${e("listScripts")}`),console.log(`  ${n.green("nrs -la")}           ${e("advancedMode")}`),console.log(`  ${n.green("nrs -s <keyword>")}  ${e("searchScripts")}`),console.log(`  ${n.green("nrs -r")}            ${e("runRecentScript")}`),console.log(`  ${n.green("nrs -r --<n>")}      ${e("runRecentScriptN")}`),console.log(`  ${n.green("nrs -rl")}           ${e("listRecentScripts")}`),console.log(`  ${n.green("nrs --list-all")}    ${e("listAllScripts")}`),console.log(`  ${n.green("nrs --help")}        ${e("showHelp")}`),console.log(n.dim(`
${e("examples")}`)),console.log(`  ${n.green("nrs -l")}            ${e("listScripts")}`),console.log(`  ${n.green("nrs -la")}           ${e("advancedMode")}`),console.log(`  ${n.green("nrs -s test")}       ${e("searchScriptsTest")}`),console.log(`  ${n.green("nrs -r --2")}        ${e("runRecentScript2")}`),console.log(`  ${n.green("nrs -v, --version")}  ${e("version")}`)},O=()=>{let s=d().version;console.log(`${e("version")} ${n.cyan(s)}`)};p.name("nrs").description(e("intro")).version(d().version,"-v, --version",e("version")).option("-l, --list",e("listScripts")).option("-a, --advanced",e("advancedMode")).option("-s, --search <keyword>",e("searchScripts")).option("-r, --recent",e("runRecentScript")).option("-rl, --recent-list",e("listRecentScripts")).option("--list-all",e("listAllScripts")).action(async(s,t)=>{if(t.args.length>0){console.log(n.yellow(e("unknownCommand",{command:t.args[0]}))),f();return}let r=process.cwd();if(s.version){O();return}if(s.lang){s.lang==="zh"||s.lang==="en"?(N=s.lang,console.log(e("languageChanged"))):(console.log(n.yellow(e("unsupportedLanguage"))),console.log(n.cyan(e("changeLanguage"))));return}if(s.listAll){let o=JSON.parse(y("./package.json","utf8")).scripts||{};console.log(n.cyan(`
${e("availableScripts")}`)),Object.entries(o).forEach(([a,g])=>{console.log(`  ${n.green(a)}: ${n.dim(g)}`)})}else if(s.recentList)W(r);else if(s.recent){let c=p.args.find(o=>o.startsWith("--"))?parseInt(p.args.find(o=>o.startsWith("--")).slice(2))-1:0;await m({recentIndex:c,projectPath:r})}else s.list||s.advanced||s.search?await m({searchTerm:s.search,advanced:s.advanced,listOnly:s.list,projectPath:r}):f()});p.parse(process.argv);process.argv.slice(2).length||p.outputHelp();module.exports={loadHistory:v,saveHistory:L,getProjectPath:M,getScripts:q,runSelectedScript:E,runScript:m,showHelp:f,showVersion:O};
